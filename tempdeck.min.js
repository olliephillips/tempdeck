var tempdeck={config:{wifi:{ssid:"",password:""},pinIn:"D0",target:20,tolerance:2,interval:5,serial:getSerial(),mqtt:{server:"test.mosquitto.org",topic:"tempdeck/esp8266/"},ifttt:{key:"",event:""}},init:function(){pinMode(tempdeck.config.pinIn,"input");tempdeck.ow=new OneWire(tempdeck.config.pinIn);tempdeck.probe=require("DS18B20").connect(tempdeck.ow);tempdeck.wifi=require("Wifi");tempdeck.wifi.connect(tempdeck.config.wifi.ssid,{password:tempdeck.config.wifi.pwd},function(a){console.log("Connected..");
tempdeck.mqttSetup();tempdeck.monitor()})},mqttSetup:function(){tempdeck.mqtt=null;tempdeck.mqtt=require("https://github.com/olliephillips/tinyMQTT/blob/master/tinyMQTT.min.js").create(tempdeck.config.mqtt.server);tempdeck.mqtt.connect();tempdeck.mqtt.on("connected",function(){tempdeck.send=!0;console.log("MQTT Server: '"+tempdeck.config.mqtt.server+"', Topic: '"+tempdeck.config.mqtt.topic+tempdeck.config.serial+"'");tempdeck.mqtt.on("disconnected",function(){tempdeck.send=!1;console.log("Disconnected");
tempdeck.mqttSetup()})})},monitor:function(){tempdeck.monitorCount=0;tempdeck.onAlert=!1;setInterval(function(){tempdeck.curTemp=tempdeck.probe.getTemp().toFixed(2);0<tempdeck.monitorCount&&(console.log("Current temp is "+tempdeck.curTemp),!0===tempdeck.send&&(tempdeck.message={targetTemp:tempdeck.config.target,currentTemp:tempdeck.curTemp},tempdeck.mqtt.publish("tempdeck/esp8266/"+tempdeck.config.serial,JSON.stringify(tempdeck.message))),tempdeck.variance=tempdeck.config.target-tempdeck.curTemp,
0>tempdeck.variance&&(tempdeck.variance*=-1),tempdeck.variance>tempdeck.config.tolerance&&0==tempdeck.onAlert&&tempdeck.alert());tempdeck.monitorCount++},1E3*tempdeck.config.interval)},alert:function(){tempdeck.alertTarget="http://maker.ifttt.com/trigger/"+tempdeck.config.ifttt.event+"/with/key/"+tempdeck.config.ifttt.key;tempdeck.alertData="?value1="+tempdeck.curTemp+"&value2="+tempdeck.config.target;require("http").get(tempdeck.alertTarget+tempdeck.alertData,function(a){a.on("close",function(){tempdeck.onAlert=
!0;console.log("Alert sent")})})}};exports.tempdeck=tempdeck;